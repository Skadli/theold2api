version: '3.8'

services:
  theold2api:
    build: .
    container_name: theold2api
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - API_KEY=${API_KEY:-your-secret-api-key}
      - UPSTREAM_URL=https://theoldllm.vercel.app/api/proxy?provider=p7
      - MAX_IDLE_CONNS=100
      - MAX_CONNS_PER_HOST=100
      - REQUEST_TIMEOUT=300s
      # Uncomment if you need proxy
      # - PROXY_URL=http://host.docker.internal:7890
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
